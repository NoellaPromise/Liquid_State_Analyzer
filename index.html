<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liquid State Analyzer</title>  
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>ðŸ§ª Liquid State Analyzer</h1>
        
        <!-- Form to get user input -->
        <form id="analyzerForm">
            <div class="form-group">
                <label for="temperature">Temperature (Â°C):</label>
                <input type="number" id="temperature" name="temperature" step="0.1" required>
            </div>

            <div class="form-group">
                <label for="pressure">Atmospheric Pressure (atm):</label>
                <input type="number" id="pressure" name="pressure" step="0.1" value="1.0" required>
            </div>

            <div class="form-group">
                <label for="liquid">Select Liquid:</label>
                <select id="liquid" name="liquid" required>
                    <option value="">Choose a liquid...</option>
                </select>
            </div>

            <button type="submit" class="analyze-button">Analyze Liquid State</button>
        </form>

        <!-- Error messages -->
        <div id="error" class="error"></div>
        
        <!-- Loading message -->
        <div id="loading" class="loading">ðŸ”¬ Analyzing liquid state...</div>

        <!-- Results display -->
        <div id="results" class="results">
            <!-- Flask container that shows the liquid state -->
            <div class="flask-container">
                <div class="flask-top"></div>
                <div class="flask-neck"></div>
                <div class="flask">
                    <div id="liquidInFlask" class="liquid-still"></div>
                </div>
            </div>

            <div class="state-title" id="stateName">LIQUID</div>
            
            <div class="result-info" id="liquidName">Liquid Name</div>
            <div class="result-info" id="currentTemp">Temperature: --Â°C</div>
            <div class="result-info" id="currentPressure">Pressure: -- atm</div>
            <div class="result-info" id="stateDescription">Description will appear here</div>
        </div>
    </div>

    <script>
        // JavaScript code that runs when page loads
        
        // Load available liquids when page starts
        window.addEventListener('load', function() {
            loadAvailableLiquids();
        });

        // Function to get available liquids from backend
        function loadAvailableLiquids() {
            // Send request to backend to get list of liquids
            fetch('http://localhost:5000/api/liquids')
                .then(response => response.json()) // Convert response to JSON
                .then(data => {
                    // Get the select dropdown element
                    const liquidSelect = document.getElementById('liquid');
                    
                    // Clear any existing options
                    liquidSelect.innerHTML = '<option value="">Choose a liquid...</option>';
                    
                    // Add each liquid as an option
                    for (const [key, name] of Object.entries(data.liquids)) {
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = name;
                        liquidSelect.appendChild(option);
                    }
                })
                .catch(error => {
                    // If there's an error, show default liquids
                    console.error('Could not load liquids from backend:', error);
                    loadDefaultLiquids();
                });
        }

        // Backup function if backend is not running
        function loadDefaultLiquids() {
            const defaultLiquids = {
                'water': 'Water (Hâ‚‚O)',
                'ethanol': 'Ethanol (Câ‚‚Hâ‚…OH)',
                'mercury': 'Mercury (Hg)',
                'nitrogen': 'Nitrogen (Nâ‚‚)',
                'oxygen': 'Oxygen (Oâ‚‚)'
            };
            
            const liquidSelect = document.getElementById('liquid');
            liquidSelect.innerHTML = '<option value="">Choose a liquid...</option>';
            
            for (const [key, name] of Object.entries(defaultLiquids)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = name;
                liquidSelect.appendChild(option);
            }
        }

        // When the form is submitted
        document.getElementById('analyzerForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Don't reload the page
            
            // Get the values from the form
            const temperature = parseFloat(document.getElementById('temperature').value);
            const pressure = parseFloat(document.getElementById('pressure').value);
            const liquidType = document.getElementById('liquid').value;
            
            // Hide previous results and errors
            document.getElementById('error').style.display = 'none';
            document.getElementById('results').classList.remove('show');
            
            // Check if all fields are filled
            if (!liquidType) {
                showError('Please select a liquid!');
                return;
            }
            
            if (pressure <= 0) {
                showError('Pressure must be greater than 0!');
                return;
            }
            
            // Show loading message
            document.getElementById('loading').style.display = 'block';
            
            // Send data to backend for analysis
            const analysisData = {
                temperature: temperature,
                pressure: pressure,
                liquid: liquidType
            };
            
            // Send POST request to backend
            fetch('http://localhost:5000/api/analyze', {
                method: 'POST', // We are sending data
                headers: {
                    'Content-Type': 'application/json', // Tell server we're sending JSON
                },
                body: JSON.stringify(analysisData) // Convert data to JSON string
            })
            .then(response => response.json()) // Convert response to JSON
            .then(data => {
                // Hide loading message
                document.getElementById('loading').style.display = 'none';
                
                if (data.success) {
                    // Show results from backend
                    displayResults(data.results);
                } else {
                    // Show error message
                    showError(data.error || 'Analysis failed');
                }
            })
            .catch(error => {
                // Hide loading message
                document.getElementById('loading').style.display = 'none';
                // Show error if request failed
                showError('Could not connect to backend server. Make sure it is running!');
                console.error('Error:', error);
            });
        });
        
        // Function to display results from backend
        function displayResults(results) {
            // Update flask state based on backend response
            showFlaskState(results.flask_state);
            
            // Set state name and color
            const stateElement = document.getElementById('stateName');
            stateElement.textContent = results.state;
            
            // Set color based on state
            stateElement.className = 'state-title';
            if (results.state === 'SOLID') {
                stateElement.classList.add('solid-state');
            } else if (results.state === 'LIQUID') {
                stateElement.classList.add('liquid-state');
            } else if (results.state === 'GAS') {
                stateElement.classList.add('gas-state');
            }
            
            // Update all the information
            document.getElementById('liquidName').textContent = results.liquid_name;
            document.getElementById('currentTemp').textContent = `Temperature: ${results.temperature}Â°C`;
            document.getElementById('currentPressure').textContent = `Pressure: ${results.pressure} atm`;
            document.getElementById('stateDescription').textContent = results.description;
            
            // Show the results
            document.getElementById('results').classList.add('show');
        }
        
        // Function to change flask appearance based on state
        function showFlaskState(state) {
            const liquidElement = document.getElementById('liquidInFlask');
            
            // Remove all state classes
            liquidElement.className = '';
            
            // Add the correct class based on state from backend
            if (state === 'frozen') {
                liquidElement.className = 'liquid-frozen';
            } else if (state === 'boiling') {
                liquidElement.className = 'liquid-boiling';
            } else {
                liquidElement.className = 'liquid-still';
            }
        }
        
        // Function to show error messages
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            document.getElementById('results').classList.remove('show');
        }
    </script>
</body>
</html>